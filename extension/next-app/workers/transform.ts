const PK_REPLACE =
  "0x61012060405234801561001157600080fd5b506040516107ac3803806107ac83398101604081905261003091610071565b6001600160a01b0394851660805292841660a05290831660c052821660e05216610100526100e6565b6001600160a01b038116811461006e57600080fd5b50565b600080600080600060a0868803121561008957600080fd5b855161009481610059565b60208701519095506100a581610059565b60408701519094506100b681610059565b60608701519093506100c781610059565b60808701519092506100d881610059565b809150509295509295909350565b60805160a05160c05160e0516101005161068361012960003960006082015260006102c10152600061022f015260006101ae0152600061010d01526106836000f3fe608060405234801561001057600080fd5b506004361061002b5760003560e01c80639d54b1df14610030575b600080fd5b61003861004e565b604051610045919061045f565b60405180910390f35b61005661034e565b7f*packed*8160000181815250507f00000000000000000000000000000000000000000000000000000000000000006001600160a01b031663fb5343f36040518163ffffffff1660e01b815260040161800060405180830381865afa1580156100df573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906101039190610629565b81604001819052507f00000000000000000000000000000000000000000000000000000000000000006001600160a01b031663f178f3136040518163ffffffff1660e01b815260040161800060405180830381865afa15801561016a573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061018e9190610629565b6020820151526040805163790a51d160e11b815290516001600160a01b037f0000000000000000000000000000000000000000000000000000000000000000169163f214a3a2916004808301926180009291908290030181865afa1580156101fa573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061021e9190610629565b6020820151600160200201819052507f00000000000000000000000000000000000000000000000000000000000000006001600160a01b031663eb12383b6040518163ffffffff1660e01b815260040161800060405180830381865afa15801561028c573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906102b09190610629565b6020820151600260200201819052507f00000000000000000000000000000000000000000000000000000000000000006001600160a01b031663539357576040518163ffffffff1660e01b815260040161800060405180830381865afa15801561031e573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906103429190610629565b60208201516060015290565b6040805160608101909152600081526020810161036961037b565b81526020016103766103a8565b905290565b60405180608001604052806004905b6103926103a8565b81526020019060019003908161038a5790505090565b6040805160a0810190915280610376602082016004815b6103c76103dd565b8152602001906001900390816103bf5790505090565b60408051612020810190915280610376602082016101008161200080368337509192915050565b8051826000805b60048110156104575783515183835b61010081101561043d57825160030b82526020928301929091019060010161041a565b50505060209390930192612000929092019160010161040b565b505050505050565b81518152602080830151620280208301919081840160005b600481101561049f5761048b828451610404565b918301916180009190910190600101610477565b5050505060408301516104b762020020840182610404565b5092915050565b634e487b7160e01b600052604160045260246000fd5b6040516020810167ffffffffffffffff811182821017156104f7576104f76104be565b60405290565b6040516080810167ffffffffffffffff811182821017156104f7576104f76104be565b604051612000810167ffffffffffffffff811182821017156104f7576104f76104be565b600061800080838503121561055857600080fd5b6105606104d4565b9150601f84601f85011261057357600080fd5b61057b6104fd565b91840191808684111561058d57600080fd5b855b8481101561061c5761200080828a0312156105aa5760008081fd5b6105b26104d4565b89868401126105c15760008081fd5b6105c9610520565b91830191808b8411156105dc5760008081fd5b845b848110156106065780518060030b81146105f85760008081fd5b8352602092830192016105de565b508252508452506020909201916120000161058f565b5084525091949350505050565b6000618000828403121561063c57600080fd5b6106468383610544565b939250505056fea264697066735822122073f1c8dfabb08a3e0a4ee17453810e702cbb3bbfd29a111be581d802b974895464736f6c63430008190033000000000000000000000000*mat0*000000000000000000000000*mat1*000000000000000000000000*mat2*000000000000000000000000*mat3*000000000000000000000000*t1*";

const POLYVEC_REPLACE =
  "0x6080604052348015600f57600080fd5b506129988061001f6000396000f3fe608060405234801561001057600080fd5b506004361061002b5760003560e01c8063*sig*14610030575b600080fd5b61003861004e565b60405161004591906128ff565b60405180910390f35b610056612893565b604080516120008101825262*0*815262*1*602082015262*2*9181019190915262*3*606082015262*4*608082015262*5*60a082015262*6*60c082015262*7*60e082015262*8*61010082015262*9*61012082015262*10*61014082015262*11*61016082015262*12*61018082015262*13*6101a082015262*14*6101c082015262*15*6101e082015262*16*61020082015262*17*61022082015262*18*61024082015262*19*61026082015262*20*61028082015262*21*6102a082015262*22*6102c082015262*23*6102e082015262*24*61030082015262*25*61032082015262*26*61034082015262*27*61036082015262*28*61038082015262*29*6103a082015262*30*6103c082015262*31*6103e082015262*32*61040082015262*33*61042082015262*34*61044082015262*35*61046082015262*36*61048082015262*37*6104a082015262*38*6104c082015262*39*6104e082015262*40*61050082015262*41*61052082015262*42*61054082015262*43*61056082015262*44*61058082015262*45*6105a082015262*46*6105c082015262*47*6105e082015262*48*61060082015262*49*61062082015262*50*61064082015262*51*61066082015262*52*61068082015262*53*6106a082015262*54*6106c082015262*55*6106e082015262*56*61070082015262*57*61072082015262*58*61074082015262*59*61076082015262*60*61078082015262*61*6107a082015262*62*6107c082015262*63*6107e082015262*64*61080082015262*65*61082082015262*66*61084082015262*67*61086082015262*68*61088082015262*69*6108a082015262*70*6108c082015262*71*6108e082015262*72*61090082015262*73*61092082015262*74*61094082015262*75*61096082015262*76*61098082015262*77*6109a082015262*78*6109c082015262*79*6109e082015262*80*610a0082015262*81*610a2082015262*82*610a4082015262*83*610a6082015262*84*610a8082015262*85*610aa082015262*86*610ac082015262*87*610ae082015262*88*610b0082015262*89*610b2082015262*90*610b4082015262*91*610b6082015262*92*610b8082015262*93*610ba082015262*94*610bc082015262*95*610be082015262*96*610c0082015262*97*610c2082015262*98*610c4082015262*99*610c6082015262*100*610c8082015262*101*610ca082015262*102*610cc082015262*103*610ce082015262*104*610d0082015262*105*610d2082015262*106*610d4082015262*107*610d6082015262*108*610d8082015262*109*610da082015262*110*610dc082015262*111*610de082015262*112*610e0082015262*113*610e2082015262*114*610e4082015262*115*610e6082015262*116*610e8082015262*117*610ea082015262*118*610ec082015262*119*610ee082015262*120*610f0082015262*121*610f2082015262*122*610f4082015262*123*610f6082015262*124*610f8082015262*125*610fa082015262*126*610fc082015262*127*610fe082015262*128*61100082015262*129*61102082015262*130*61104082015262*131*61106082015262*132*61108082015262*133*6110a082015262*134*6110c082015262*135*6110e082015262*136*61110082015262*137*61112082015262*138*61114082015262*139*61116082015262*140*61118082015261*141*6111a082015262*142*6111c082015262*143*6111e082015262*144*61120082015262*145*61122082015262*146*61124082015262*147*61126082015262*148*61128082015262*149*6112a082015262*150*6112c082015262*151*6112e082015262*152*61130082015262*153*61132082015262*154*61134082015262*155*61136082015262*156*61138082015262*157*6113a082015262*158*6113c082015262*159*6113e082015262*160*61140082015262*161*61142082015262*162*61144082015262*163*61146082015262*164*61148082015262*165*6114a082015262*166*6114c082015262*167*6114e082015262*168*61150082015262*169*61152082015262*170*61154082015262*171*61156082015262*172*61158082015262*173*6115a082015262*174*6115c082015262*175*6115e082015262*176*61160082015262*177*61162082015262*178*61164082015262*179*61166082015262*180*61168082015262*181*6116a082015262*182*6116c082015262*183*6116e082015262*184*61170082015262*185*61172082015262*186*61174082015262*187*61176082015262*188*61178082015262*189*6117a082015262*190*6117c082015262*191*6117e082015262*192*61180082015262*193*61182082015262*194*61184082015262*195*61186082015262*196*61188082015262*197*6118a082015262*198*6118c082015262*199*6118e082015262*200*61190082015262*201*61192082015262*202*61194082015262*203*61196082015262*204*61198082015262*205*6119a082015262*206*6119c082015262*207*6119e082015262*208*611a0082015262*209*611a2082015262*210*611a4082015262*211*611a6082015262*212*611a8082015262*213*611aa082015262*214*611ac082015262*215*611ae082015262*216*611b0082015262*217*611b2082015262*218*611b4082015262*219*611b6082015262*220*611b8082015262*221*611ba082015262*222*611bc082015262*223*611be082015262*224*611c0082015262*225*611c2082015262*226*611c4082015262*227*611c6082015262*228*611c8082015262*229*611ca082015262*230*611cc082015262*231*611ce082015262*232*611d0082015262*233*611d2082015262*234*611d4082015262*235*611d6082015262*236*611d8082015262*237*611da082015262*238*611dc082015262*239*611de082015262*240*611e0082015262*241*611e2082015262*242*611e4082015262*243*611e6082015262*244*611e8082015262*245*611ea082015262*246*611ec082015262*247*611ee082015262*248*611f0082015261*249*611f2082015262*250*611f4082015262*251*611f6082015262*252*611f8082015262*253*611fa082015262*254*611fc082015262*255*611fe0820152815160006020908102919091015191909152604080516120008101825262*256*815262*257*9281019290925262*258*9082015262*259*606082015262*260*608082015262*261*60a082015262*262*60c082015262*263*60e082015262*264*61010082015262*265*61012082015262*266*61014082015262*267*61016082015262*268*61018082015262*269*6101a082015262*270*6101c082015262*271*6101e082015262*272*61020082015262*273*61022082015262*274*61024082015262*275*61026082015262*276*61028082015262*277*6102a082015262*278*6102c082015262*279*6102e082015262*280*61030082015262*281*61032082015262*282*61034082015262*283*61036082015262*284*61038082015262*285*6103a082015262*286*6103c082015262*287*6103e082015262*288*61040082015262*289*61042082015262*290*61044082015262*291*61046082015262*292*61048082015262*293*6104a082015262*294*6104c082015262*295*6104e082015262*296*61050082015262*297*61052082015262*298*61054082015262*299*61056082015262*300*61058082015262*301*6105a082015262*302*6105c082015262*303*6105e082015262*304*61060082015262*305*61062082015262*306*61064082015262*307*61066082015262*308*61068082015262*309*6106a082015262*310*6106c082015262*311*6106e082015262*312*61070082015262*313*61072082015262*314*61074082015262*315*61076082015262*316*61078082015262*317*6107a082015262*318*6107c082015262*319*6107e082015262*320*61080082015262*321*61082082015262*322*61084082015262*323*61086082015262*324*61088082015262*325*6108a082015262*326*6108c082015262*327*6108e082015262*328*61090082015262*329*61092082015262*330*61094082015262*331*61096082015262*332*61098082015262*333*6109a082015262*334*6109c082015262*335*6109e082015262*336*610a0082015262*337*610a2082015262*338*610a4082015262*339*610a6082015262*340*610a8082015262*341*610aa082015262*342*610ac082015262*343*610ae082015262*344*610b0082015262*345*610b2082015262*346*610b4082015262*347*610b6082015262*348*610b8082015262*349*610ba082015262*350*610bc082015262*351*610be082015262*352*610c0082015262*353*610c2082015262*354*610c4082015262*355*610c6082015262*356*610c8082015262*357*610ca082015262*358*610cc082015262*359*610ce082015262*360*610d0082015262*361*610d2082015262*362*610d4082015262*363*610d6082015262*364*610d8082015262*365*610da082015262*366*610dc082015262*367*610de082015262*368*610e0082015262*369*610e2082015262*370*610e4082015262*371*610e6082015262*372*610e8082015262*373*610ea082015262*374*610ec082015262*375*610ee082015262*376*610f0082015262*377*610f2082015262*378*610f4082015262*379*610f6082015262*380*610f8082015262*381*610fa082015262*382*610fc082015262*383*610fe082015262*384*61100082015262*385*61102082015262*386*61104082015262*387*61106082015262*388*61108082015262*389*6110a082015262*390*6110c082015262*391*6110e082015262*392*61110082015262*393*61112082015262*394*61114082015262*395*61116082015262*396*61118082015262*397*6111a082015262*398*6111c082015262*399*6111e082015262*400*61120082015262*401*61122082015262*402*61124082015262*403*61126082015262*404*61128082015262*405*6112a082015262*406*6112c082015262*407*6112e082015262*408*61130082015262*409*61132082015262*410*61134082015262*411*61136082015262*412*61138082015262*413*6113a082015262*414*6113c082015262*415*6113e082015262*416*61140082015262*417*61142082015262*418*61144082015262*419*61146082015262*420*61148082015262*421*6114a082015262*422*6114c082015262*423*6114e082015262*424*61150082015262*425*61152082015262*426*61154082015262*427*61156082015262*428*61158082015262*429*6115a082015262*430*6115c082015262*431*6115e082015262*432*61160082015262*433*61162082015262*434*61164082015262*435*61166082015262*436*61168082015262*437*6116a082015262*438*6116c082015262*439*6116e082015262*440*61170082015262*441*61172082015262*442*61174082015262*443*61176082015262*444*61178082015262*445*6117a082015262*446*6117c082015262*447*6117e082015262*448*61180082015262*449*61182082015262*450*61184082015262*451*61186082015262*452*61188082015261*453*6118a082015262*454*6118c082015262*455*6118e082015262*456*61190082015262*457*61192082015262*458*61194082015262*459*61196082015262*460*61198082015262*461*6119a082015262*462*6119c082015262*463*6119e082015262*464*611a0082015262*465*611a2082015262*466*611a4082015262*467*611a6082015262*468*611a8082015262*469*611aa082015262*470*611ac082015262*471*611ae082015262*472*611b0082015262*473*611b2082015262*474*611b4082015262*475*611b6082015262*476*611b8082015262*477*611ba082015262*478*611bc082015262*479*611be082015262*480*611c0082015262*481*611c2082015262*482*611c4082015262*483*611c6082015262*484*611c8082015262*485*611ca082015262*486*611cc082015262*487*611ce082015262*488*611d0082015262*489*611d2082015262*490*611d4082015262*491*611d6082015262*492*611d8082015262*493*611da082015262*494*611dc082015262*495*611de082015261*496*611e0082015262*497*611e2082015262*498*611e4082015262*499*611e6082015262*500*611e8082015262*501*611ea082015262*502*611ec082015262*503*611ee082015262*504*611f0082015262*505*611f2082015262*506*611f4082015262*507*611f6082015262*508*611f8082015262*509*611fa082015262*510*611fc082015262*511*611fe0820152815160016020908102919091015191909152604080516120008101825262*512*815262*513*9281019290925262*514*9082015262*515*606082015262*516*608082015262*517*60a082015262*518*60c082015262*519*60e082015262*520*61010082015262*521*61012082015262*522*61014082015262*523*61016082015262*524*61018082015262*525*6101a082015262*526*6101c082015262*527*6101e082015262*528*61020082015262*529*61022082015262*530*61024082015262*531*61026082015262*532*61028082015262*533*6102a082015262*534*6102c082015262*535*6102e082015262*536*61030082015262*537*61032082015262*538*61034082015261*539*61036082015262*540*61038082015262*541*6103a082015262*542*6103c082015262*543*6103e082015262*544*61040082015262*545*61042082015262*546*61044082015262*547*61046082015262*548*61048082015262*549*6104a082015262*550*6104c082015262*551*6104e082015262*552*61050082015262*553*61052082015262*554*61054082015262*555*61056082015262*556*61058082015262*557*6105a082015262*558*6105c082015262*559*6105e082015262*560*61060082015262*561*61062082015262*562*61064082015262*563*61066082015262*564*61068082015262*565*6106a082015262*566*6106c082015262*567*6106e082015262*568*61070082015262*569*61072082015262*570*61074082015262*571*61076082015262*572*61078082015262*573*6107a082015262*574*6107c082015262*575*6107e082015262*576*61080082015262*577*61082082015262*578*61084082015262*579*61086082015262*580*61088082015262*581*6108a082015262*582*6108c082015262*583*6108e082015262*584*61090082015262*585*61092082015262*586*61094082015262*587*61096082015262*588*61098082015262*589*6109a082015262*590*6109c082015262*591*6109e082015262*592*610a0082015262*593*610a2082015262*594*610a4082015262*595*610a6082015262*596*610a8082015262*597*610aa082015262*598*610ac082015262*599*610ae082015262*600*610b0082015262*601*610b2082015262*602*610b4082015262*603*610b6082015262*604*610b8082015262*605*610ba082015262*606*610bc082015262*607*610be082015262*608*610c0082015262*609*610c2082015262*610*610c4082015262*611*610c6082015262*612*610c8082015262*613*610ca082015262*614*610cc082015262*615*610ce082015262*616*610d0082015262*617*610d2082015262*618*610d4082015262*619*610d6082015262*620*610d8082015262*621*610da082015262*622*610dc082015262*623*610de082015262*624*610e0082015262*625*610e2082015262*626*610e4082015262*627*610e6082015262*628*610e8082015262*629*610ea082015262*630*610ec082015262*631*610ee082015262*632*610f0082015262*633*610f2082015262*634*610f4082015262*635*610f6082015262*636*610f8082015262*637*610fa082015262*638*610fc082015262*639*610fe082015262*640*61100082015262*641*61102082015262*642*61104082015262*643*61106082015262*644*61108082015262*645*6110a082015262*646*6110c082015262*647*6110e082015262*648*61110082015262*649*61112082015262*650*61114082015262*651*61116082015262*652*61118082015262*653*6111a082015262*654*6111c082015262*655*6111e082015262*656*61120082015262*657*61122082015262*658*61124082015262*659*61126082015262*660*61128082015262*661*6112a082015262*662*6112c082015262*663*6112e082015262*664*61130082015262*665*61132082015262*666*61134082015262*667*61136082015262*668*61138082015262*669*6113a082015262*670*6113c082015262*671*6113e082015262*672*61140082015262*673*61142082015262*674*61144082015262*675*61146082015262*676*61148082015262*677*6114a082015262*678*6114c082015262*679*6114e082015262*680*61150082015262*681*61152082015262*682*61154082015262*683*61156082015262*684*61158082015262*685*6115a082015262*686*6115c082015262*687*6115e082015262*688*61160082015262*689*61162082015262*690*61164082015262*691*61166082015262*692*61168082015262*693*6116a082015262*694*6116c082015262*695*6116e082015262*696*61170082015262*697*61172082015262*698*61174082015262*699*61176082015262*700*61178082015262*701*6117a082015262*702*6117c082015262*703*6117e082015262*704*61180082015262*705*61182082015262*706*61184082015262*707*61186082015262*708*61188082015262*709*6118a082015262*710*6118c082015262*711*6118e082015262*712*61190082015262*713*61192082015262*714*61194082015262*715*61196082015262*716*61198082015262*717*6119a082015262*718*6119c082015262*719*6119e082015262*720*611a0082015262*721*611a2082015262*722*611a4082015262*723*611a6082015262*724*611a8082015262*725*611aa082015262*726*611ac082015262*727*611ae082015262*728*611b0082015262*729*611b2082015262*730*611b4082015262*731*611b6082015262*732*611b8082015262*733*611ba082015262*734*611bc082015262*735*611be082015262*736*611c0082015262*737*611c2082015262*738*611c4082015262*739*611c6082015262*740*611c8082015262*741*611ca082015262*742*611cc082015262*743*611ce082015262*744*611d0082015262*745*611d2082015262*746*611d4082015262*747*611d6082015261*748*611d8082015262*749*611da082015262*750*611dc082015262*751*611de082015262*752*611e0082015262*753*611e2082015262*754*611e4082015262*755*611e6082015262*756*611e8082015262*757*611ea082015262*758*611ec082015262*759*611ee082015262*760*611f0082015262*761*611f2082015262*762*611f4082015262*763*611f6082015262*764*611f8082015262*765*611fa082015262*766*611fc082015262*767*611fe0820152815160026020908102919091015191909152604080516120008101825262*768*815262*769*9281019290925262*770*9082015262*771*606082015262*772*608082015262*773*60a082015262*774*60c082015262*775*60e082015262*776*61010082015262*777*61012082015262*778*61014082015262*779*61016082015262*780*61018082015262*781*6101a082015262*782*6101c082015262*783*6101e082015262*784*61020082015262*785*61022082015262*786*61024082015262*787*61026082015262*788*61028082015262*789*6102a082015262*790*6102c082015262*791*6102e082015262*792*61030082015262*793*61032082015262*794*61034082015262*795*61036082015262*796*61038082015262*797*6103a082015262*798*6103c082015262*799*6103e082015262*800*61040082015262*801*61042082015262*802*61044082015262*803*61046082015262*804*61048082015262*805*6104a082015262*806*6104c082015262*807*6104e082015262*808*61050082015262*809*61052082015262*810*61054082015262*811*61056082015262*812*61058082015262*813*6105a082015262*814*6105c082015262*815*6105e082015262*816*61060082015262*817*61062082015262*818*61064082015262*819*61066082015262*820*61068082015262*821*6106a082015262*822*6106c082015262*823*6106e082015262*824*61070082015262*825*61072082015262*826*61074082015262*827*61076082015262*828*61078082015262*829*6107a082015262*830*6107c082015262*831*6107e082015262*832*61080082015262*833*61082082015262*834*61084082015262*835*61086082015262*836*61088082015262*837*6108a082015262*838*6108c082015262*839*6108e082015262*840*61090082015262*841*61092082015262*842*61094082015262*843*61096082015262*844*61098082015262*845*6109a082015262*846*6109c082015262*847*6109e082015262*848*610a0082015262*849*610a2082015262*850*610a4082015262*851*610a6082015262*852*610a8082015262*853*610aa082015262*854*610ac082015262*855*610ae082015262*856*610b0082015262*857*610b2082015262*858*610b4082015262*859*610b6082015262*860*610b8082015262*861*610ba082015262*862*610bc082015262*863*610be082015262*864*610c0082015262*865*610c2082015262*866*610c4082015262*867*610c6082015262*868*610c8082015262*869*610ca082015262*870*610cc082015262*871*610ce082015262*872*610d0082015262*873*610d2082015262*874*610d4082015262*875*610d6082015262*876*610d8082015262*877*610da082015262*878*610dc082015262*879*610de082015262*880*610e0082015262*881*610e2082015262*882*610e4082015262*883*610e6082015262*884*610e8082015262*885*610ea082015262*886*610ec082015262*887*610ee082015262*888*610f0082015262*889*610f2082015262*890*610f4082015262*891*610f6082015262*892*610f8082015262*893*610fa082015262*894*610fc082015262*895*610fe082015262*896*61100082015262*897*61102082015262*898*61104082015262*899*61106082015262*900*61108082015262*901*6110a082015262*902*6110c082015262*903*6110e082015262*904*61110082015262*905*61112082015262*906*61114082015262*907*61116082015262*908*61118082015262*909*6111a082015262*910*6111c082015262*911*6111e082015262*912*61120082015262*913*61122082015262*914*61124082015262*915*61126082015262*916*61128082015262*917*6112a082015262*918*6112c082015262*919*6112e082015262*920*61130082015262*921*61132082015262*922*61134082015262*923*61136082015262*924*61138082015262*925*6113a082015262*926*6113c082015262*927*6113e082015262*928*61140082015261*929*61142082015262*930*61144082015262*931*61146082015262*932*61148082015262*933*6114a082015262*934*6114c082015262*935*6114e082015262*936*61150082015262*937*61152082015262*938*61154082015262*939*61156082015262*940*61158082015262*941*6115a082015262*942*6115c082015262*943*6115e082015262*944*61160082015262*945*61162082015262*946*61164082015262*947*61166082015262*948*61168082015262*949*6116a082015262*950*6116c082015262*951*6116e082015262*952*61170082015262*953*61172082015262*954*61174082015262*955*61176082015262*956*61178082015262*957*6117a082015262*958*6117c082015262*959*6117e082015262*960*61180082015262*961*61182082015262*962*61184082015262*963*61186082015262*964*61188082015262*965*6118a082015262*966*6118c082015262*967*6118e082015262*968*61190082015262*969*61192082015262*970*61194082015262*971*61196082015262*972*61198082015262*973*6119a082015262*974*6119c082015262*975*6119e082015262*976*611a0082015262*977*611a2082015262*978*611a4082015262*979*611a6082015261*980*611a8082015262*981*611aa082015262*982*611ac082015262*983*611ae082015262*984*611b0082015262*985*611b2082015262*986*611b4082015262*987*611b6082015262*988*611b8082015262*989*611ba082015262*990*611bc082015262*991*611be082015262*992*611c0082015262*993*611c2082015262*994*611c4082015262*995*611c6082015262*996*611c8082015262*997*611ca082015262*998*611cc082015262*999*611ce082015262*1000*611d0082015262*1001*611d2082015262*1002*611d4082015262*1003*611d6082015262*1004*611d8082015262*1005*611da082015262*1006*611dc082015262*1007*611de082015262*1008*611e0082015262*1009*611e2082015262*1010*611e4082015262*1011*611e6082015262*1012*611e8082015262*1013*611ea082015262*1014*611ec082015262*1015*611ee082015262*1016*611f0082015262*1017*611f2082015262*1018*611f4082015262*1019*611f6082015262*1020*611f8082015262*1021*611fa082015262*1022*611fc082015262*1023*611fe08201528151606001515290565b60405180602001604052806128a66128ab565b905290565b60405180608001604052806004905b6128c26128d8565b8152602001906001900390816128ba5790505090565b604080516120208101909152806128a6602082016101008161200080368337509192915050565b8151618000820190826000805b60048110156129585783515183835b61010081101561293e57825160030b82526020928301929091019060010161291b565b50505060209390930192612000929092019160010161290c565b505050509291505056fea2646970667358221220bc6b9cb0f483ca7c982522a98d472f167c81eff5dab741534a18ceb87600a16764736f6c63430008190033";

const i32toHex = (i32: number) => {
  if (i32 < 0) {
    return (0xffffffff + i32 + 1).toString(16);
  } else {
    const s = i32.toString(16);
    if (s.length % 2 === 1) {
      return "0" + s;
    } else {
      return s;
    }
  }
};

interface Polyvec {
  vec: { coeffs: number[] }[];
}

const mat = (sig: string, polyvec: Polyvec) => {
  const allCoeffs: string[] = [];
  for (const vec of polyvec.vec) {
    for (const coeff of vec.coeffs) {
      // encode to i32 be bytes hex string
      allCoeffs.push(i32toHex(coeff));
    }
  }

  let finalBytecode = POLYVEC_REPLACE;
  finalBytecode = finalBytecode.replace("*sig*", sig);
  for (let i = 0; i < allCoeffs.length; i++) {
    finalBytecode = finalBytecode.replace(`*${i}*`, allCoeffs[i]);
  }
  return finalBytecode;
};

export const mat0 = (polyvec: Polyvec) => {
  return mat("f178f313", polyvec);
};

export const mat1 = (polyvec: Polyvec) => {
  return mat("f214a3a2", polyvec);
};

export const mat2 = (polyvec: Polyvec) => {
  return mat("eb12383b", polyvec);
};

export const mat3 = (polyvec: Polyvec) => {
  return mat("53935757", polyvec);
};

export const t1 = (polyvec: Polyvec) => {
  return mat("fb5343f3", polyvec);
};

export const pk = (
  mat0Addr: string,
  mat1Addr: string,
  mat2Addr: string,
  mat3Addr: string,
  t1Addr: string,
  packed: string
) => {
  let finalBytecode = PK_REPLACE;
  finalBytecode = finalBytecode.replace("*mat0*", mat0Addr.replace("0x", ""));
  finalBytecode = finalBytecode.replace("*mat1*", mat1Addr.replace("0x", ""));
  finalBytecode = finalBytecode.replace("*mat2*", mat2Addr.replace("0x", ""));
  finalBytecode = finalBytecode.replace("*mat3*", mat3Addr.replace("0x", ""));
  finalBytecode = finalBytecode.replace("*t1*", t1Addr.replace("0x", ""));
  finalBytecode = finalBytecode.replace("*packed*", packed.replace("0x", ""));
  return finalBytecode;
};
